[[espresso_usageintroduction]]
== Writing Espresso unit tests

[[espresso_usageintroduction_staticimports]]
=== Location of Espresso tests and required static imports

Espresso tests must be placed in the _app/src/androidTest_ folder.

To simplify the usage of the  Espresso API it is recommended to add the following static imports.
This allows to access these methods without the class prefix. 

[source,java]
----
include::res/imports/example.java[]
----

[[espresso_usageintroduction_viewmatcher]]
=== Using ViewMatcher
		
To find a view, use the `onView()` method with a view matcher which selects the correct view. 
If you are using an AdapterView use the `onData()` method instead of the `onView()` method. The
The `onView()` methods return an object of type `ViewInteraction`. 
The `onData()` method returns an object of type `DataInteraction`.
		
The following table describes the available matchers.

.Table Available ViewMatcher
|===
|ViewMatcher|Description

|withText("SOMETEXT")
|Searches for a view with the specified text, for example onView(withText("User")) searches for a view with the text "User".

|withId()
|Similar to withText but searches for the ID

|Hamcrest Matchers
|You can use Hamcrest matchers, e.g., `containsString` or `instanceOf()`. 
It is also possible to combine matchers with `allOf()`. 
If you want to exclude views, use `allOf()` together with `not())`. 
Example: `onView(allOf(withId(R.id.button_login), not(withText("Logout "))));`

|===
		
[[espresso_usageintroduction_viewaction]]
=== Performing Actions

`ViewInteraction` and `DataInteraction` allow to specify an action for test via an object of type `ViewAction` via the `perform` method.
The `ViewActions` class provides helper methods for the most common actions, like:

* `ViewActions.click`
* `ViewActions.typeText()`
* `ViewActions.pressKey()`
* `ViewActions.clearText()`
		
The `perform` method returns again an object of type `ViewInteraction` on which you can perform more actions or validate the result. 
It also uses varags as argument, i.e, you can pass several actions at the same time to it.

[[espresso_usageintroduction_viewcheck]]
=== Verifying test results
		
Call the `ViewInteraction.check()` method to assert a view state. 
This method expects a `ViewAssertion` object as input. 
The `ViewAssertions` class provides helper methods for creating these objects:

* matches - Hamcrest matcher
* doesNotExist - asserts that the select view does not exist

[[espresso_usageintroduction_instrumentationaccess]]
=== Access to the instrumentation API
		
Via the `InstrumentationRegistry.getTargetContext()` you have access to the target context of your application. 
For example, if you want to use the id without using R.id you can use the following helper method to determine it.


[source,java]
----
include::res/instrumentation/getId.java[]
----
		
[[espresso_usageintroduction_configurationstartintent]]
=== Configuring the start intent for the activity
		
If you specify `false` as third parameter in the `ActivityTestRule`, you can configure the intent for starting the activity.
This is as demonstrated in the following code example.
		
		
[source,java]
----
include::res/intentconfig/SecondActivityTest.java[]
----

=== Espresso UI recorder

Android Studio provides an menu:Run[Record Espresso Test] menu entry which allows you to record the interaction with your application and create a Espresso test from it.




[[espresso_runningespressotests]]
=== Running Espresso tests


[[espresso_runningespressotests_androidstudio]]
==== Using Android Studio
        
Right-click on your test and select _Run_.

image::runUnitTestInAndroidStudio10.png[Run Espresso tests in Android Studio]
        
[[espresso_runningespressotests_gradle]]
==== Using Gradle
        

Use the `connectedCheck` task in Gradle to run the test directly via Gradle.

image::androidstudiogradleview.png[Running Gradle tasks via Android Studio]
        


			