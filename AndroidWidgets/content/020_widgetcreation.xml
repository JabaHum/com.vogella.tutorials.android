<section id="widgetbroadcastreceiver" role="wrapper">
	<title>Creating the Broadcast receiver for the widget</title>
	<section id="overview_register">
		<title>Create and configure widget</title>
		<para>
			To register a widget, you create a broadcast receiver
			with an intent
			filter for the
			<code>android.appwidget.action.APPWIDGET_UPDATE</code>
			action.
		</para>
		<para>
			<programlisting language="xml">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="../examples/config/register.xml" />
			</programlisting>
		</para>
		<para>
			The receiver
			can get a label and icon assigned. These are used
			in the list
			of
			available widgets in the Android launcher.
		</para>
		<para>
			You also specify the meta-data for the widget
			via the
			<code>android:name="android.appwidget.provider</code>
			attribute. The configuration file referred by this
			metadata
			contains
			the configuration settings for the
			widget.
			It contains, for example, the
			update interface, the size and
			the
			initial layout of
			the widget.
		</para>
		<para>
			<programlisting language="xml">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="../examples/config/widget_info.xml" />
			</programlisting>
		</para>
	</section>

	<section id="overview_views">
		<title>Available views and layouts</title>
		<para>
			A widget is restricted in the
			<code>View</code>
			classes it can use. As layouts you
			can
			use the
			<code>FrameLayout</code>,
			<code>LinearLayout</code>
			and
			<code>RelativeLayout</code>
			classes. As views you can use
			<code>AnalogClock</code>,
			<code>Button</code>,
			<code>Chromometer</code>,
			<code>ImageButton</code>,
			<code>ImageView</code>,
			<code>ProgressBar</code>
			and
			<code>TextView</code>.
		</para>
		<para>
			As of Android 3.0 more views are available:
			<code>GridView</code>,
			<code>ListView</code>,
			<code>StackView</code>,
			<code>ViewFlipper</code>
			and
			<code>AdapterViewFlipper</code>.
			These adapter
			views
			require that you define a
			<wordasword>collection view widget</wordasword>
			which is described later in this $book.
		</para>
		<para>
			The only interaction that is possible with the
			views
			of a
			widget
			is via
			an
			<code>OnClickListener</code> event.
			This
			<code>OnClickListener</code>
			can be registered on a widget and is triggered by the user.
		</para>
	</section>

	<section id="overview_appwidgetprovider">
		<title>AppWidgetProvider</title>
		<para>
			Your
			<code>BroadcastReceiver</code>
			implementation
			typically
			extends the
			<code>AppWidgetProvider</code>
			class.
		</para>
		<para>
			The
			<code>AppWidgetProvider</code>
			class implements the
			<code>onReceive()</code>
			method, extracts the required information and calls the
			following
			widget life cycle methods.
		</para>
		<para>
			As you can add several instances of a widget to the
			home screen,
			you have life cycle methods which are called only for the
			first
			instance added / removed to the home screen and others which are
			called for every instance of your widget.
		</para>

		<table frame='all'>
			<title>Life cycle method</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' colwidth="1*" />
				<colspec colname='c2' colwidth="3*" />
				<thead>
					<row>
						<entry>Method</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry><code>onEnabled()</code></entry>
						<entry>
							Called the first time an instance of your widget is added
							to the home screen.
						</entry>
					</row>
					<row>
						<entry><code>onDisabled()</code></entry>
						<entry>
							Called once the last instance of your widget is removed
							from the home screen.
						</entry>
					</row>
					<row>
						<entry><code>onUpdate()</code></entry>
						<entry>
							Called for every update of the widget. Contains the ids of
							<code>appWidgetIds</code> for which an update is needed.
							Note that this may be
							all of the <code>AppWidget</code> instances for this
							provider, or just a subset
							of them, as stated in the method's
							JavaDoc. For example, if more
							than one widget is added to the home screen, only the
							last one
							changes (until reinstall).
						</entry>
					</row>
					<row>
						<entry><code>onDeleted()</code></entry>
						<entry>Widget instance is removed from the home screen.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>

	<section id="overview_appwidgetprovider_async">
		<title>Receiver and asynchronous processing</title>

		<para>
			A widget has the same runtime restrictions as a normal
			broadcast
			receiver, i.e., it has only 5 seconds to finish its processing.
		</para>
		<para>
			A
			receive (widget)
			should therefore perform
			time consuming
			operations
			in a service
			and perform the update of
			the
			widgets
			from
			the
			service.
		</para>
	</section>

</section>